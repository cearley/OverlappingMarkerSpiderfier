(function(){/*
 OverlappingMarkerSpiderfier
https://github.com/cearley/OverlappingMarkerSpiderfier
Forked from M1ke/OverlappingMarkerSpiderfier
Original code at https://github.com/jawj/OverlappingMarkerSpiderfier
Copyright (c) 2011 - 2013 George MacKerron
Released under the MIT licence: http://opensource.org/licenses/mit-license
Note: The Google Maps API v3 must be included *before* this code
*/
(function(){var w,y={}.hasOwnProperty,z=[].slice;null!=(null!=(w=this.google)?w.maps:void 0)&&(this.OverlappingMarkerSpiderfier=function(){function v(b,c){var a,g,e,f;this.map=b;null==c&&(c={});for(a in c)y.call(c,a)&&(g=c[a],this[a]=g);this.projHelper=new this.constructor.ProjHelper(this.map);this.initMarkerArrays();this.listeners={};f=["click","zoom_changed","maptypeid_changed"];g=0;for(e=f.length;g<e;g++)a=f[g],k.addListener(this.map,a,function(a){return function(){return a.unspiderfy()}}(this))}
var k,t,r,u,p,d,x,w;d=v.prototype;p=[v,d];r=0;for(u=p.length;r<u;r++)w=p[r],w.VERSION="0.3.3";t=google.maps;k=t.event;p=t.MapTypeId;x=2*Math.PI;d.keepSpiderfied=!1;d.markersWontHide=!1;d.markersWontMove=!1;d.nearbyDistance=20;d.circleSpiralSwitchover=9;d.circleFootSeparation=43;d.circleStartAngle=x/12;d.spiralFootSeparation=26;d.spiralLengthStart=11;d.spiralLengthFactor=4;d.spiderfiedZIndex=1E3;d.usualLegZIndex=10;d.highlightedLegZIndex=20;d.legWeight=1.5;d.legColors={usual:{},highlighted:{}};u=d.legColors.usual;
r=d.legColors.highlighted;u[p.HYBRID]=u[p.SATELLITE]="#fff";r[p.HYBRID]=r[p.SATELLITE]="#f00";u[p.TERRAIN]=u[p.ROADMAP]="#444";r[p.TERRAIN]=r[p.ROADMAP]="#f00";d.destroy=function(){var b,c,a,g;g=["click","zoom_changed","maptypeid_changed"];c=0;for(a=g.length;c<a;c++)b=g[c],k.clearListeners(this.map,b);this.projHelper.setMap(null);return this.map=this.projHelper=null};d.initMarkerArrays=function(){this.markers=[];return this.markerListenerRefs=[]};d.addMarker=function(b){var c;if(null!=b._oms)return this;
b._oms=!0;c=[k.addListener(b,"click",function(a){return function(c){return a.spiderListener(b,c)}}(this))];this.markersWontHide||c.push(k.addListener(b,"visible_changed",function(a){return function(){return a.markerChangeListener(b,!1)}}(this)));this.markersWontMove||c.push(k.addListener(b,"position_changed",function(a){return function(){return a.markerChangeListener(b,!0)}}(this)));this.markerListenerRefs.push(c);this.markers.push(b);return this};d.markerChangeListener=function(b,c){if(null!=b._omsData&&
(c||!b.getVisible())&&null==this.spiderfying&&null==this.unspiderfying)return this.unspiderfy(c?b:null)};d.getMarkers=function(){return this.markers.slice(0)};d.removeMarker=function(b){var c,a,g,e,f;null!=b._omsData&&this.unspiderfy();c=this.arrIndexOf(this.markers,b);if(0>c)return this;f=this.markerListenerRefs.splice(c,1)[0];a=0;for(g=f.length;a<g;a++)e=f[a],k.removeListener(e);delete b._oms;this.markers.splice(c,1);return this};d.clearMarkers=function(){var b,c,a,g,e,f,d,h;this.unspiderfy();h=
this.markers;b=c=0;for(a=h.length;c<a;b=++c){f=h[b];e=this.markerListenerRefs[b];d=0;for(b=e.length;d<b;d++)g=e[d],k.removeListener(g);delete f._oms}this.initMarkerArrays();return this};d.addListener=function(b,c){var a;(null!=(a=this.listeners)[b]?a[b]:a[b]=[]).push(c);return this};d.removeListener=function(b,c){var a;a=this.arrIndexOf(this.listeners[b],c);0>a||this.listeners[b].splice(a,1);return this};d.clearListeners=function(b){this.listeners[b]=[];return this};d.trigger=function(){var b,c,a,
g,e,f;c=arguments[0];b=2<=arguments.length?z.call(arguments,1):[];c=null!=(a=this.listeners[c])?a:[];f=[];g=0;for(e=c.length;g<e;g++)a=c[g],f.push(a.apply(null,b));return f};d.generatePtsCircle=function(b,c){var a,g,e,f,d;f=this.circleFootSeparation*(2+b)/x;g=x/b;d=[];for(a=e=0;0<=b?e<b:e>b;a=0<=b?++e:--e)a=this.circleStartAngle+a*g,d.push(new t.Point(c.x+f*Math.cos(a),c.y+f*Math.sin(a)));return d};d.generatePtsSpiral=function(b,c){var a,g,e,f,d;f=this.spiralLengthStart;a=0;d=[];for(g=e=0;0<=b?e<
b:e>b;g=0<=b?++e:--e)a+=this.spiralFootSeparation/f+5E-4*g,g=new t.Point(c.x+f*Math.cos(a),c.y+f*Math.sin(a)),f+=x*this.spiralLengthFactor/a,d.push(g);return d};d.spiderListener=function(b,c){var a,g,e,f,d,h,l,m,n;(h=null!=b._omsData)&&this.keepSpiderfied||this.unspiderfy();if(h||this.map.getStreetView().getVisible()||"GoogleEarthAPI"===this.map.getMapTypeId())return this.trigger("click",b,c);h=[];l=[];a=this.nearbyDistance;m=a*a;d=this.llToPt(b.getPosition());n=this.markers;a=0;for(g=n.length;a<
g;a++)e=n[a],null!=e.getMap()&&e.getVisible()&&(f=this.llToPt(e.getPosition()),this.ptDistanceSq(f,d)<m?h.push({marker:e,markerPt:f}):l.push(e));return 1===h.length?this.trigger("click",b,c):this.spiderfy(h,l)};d.markersNearMarker=function(b,c){var a,g,e,d,q,h,l,m,n,k;null==c&&(c=!1);if(null==this.projHelper.getProjection())throw"Must wait for 'idle' event on map before calling markersNearMarker";a=this.nearbyDistance;l=a*a;q=this.llToPt(b.getPosition());h=[];m=this.markers;a=0;for(g=m.length;a<g&&
!(e=m[a],e!==b&&null!=e.getMap()&&e.getVisible()&&(d=this.llToPt(null!=(n=null!=(k=e._omsData)?k.usualPosition:void 0)?n:e.getPosition()),this.ptDistanceSq(d,q)<l&&(h.push(e),c)));a++);return h};d.markersNearAnyOtherMarker=function(){var b,c,a,g,e,d,q,h,l,m,n,k;if(null==this.projHelper.getProjection())throw"Must wait for 'idle' event on map before calling markersNearAnyOtherMarker";m=this.nearbyDistance;b=m*m;d=this.markers;m=[];n=0;for(a=d.length;n<a;n++)c=d[n],m.push({pt:this.llToPt(null!=(g=null!=
(e=c._omsData)?e.usualPosition:void 0)?g:c.getPosition()),willSpiderfy:!1});n=this.markers;c=g=0;for(e=n.length;g<e;c=++g)if(a=n[c],null!=a.getMap()&&a.getVisible()&&(q=m[c],!q.willSpiderfy))for(k=this.markers,a=l=0,d=k.length;l<d;a=++l)if(h=k[a],a!==c&&null!=h.getMap()&&h.getVisible()&&(h=m[a],(!(a<c)||h.willSpiderfy)&&this.ptDistanceSq(q.pt,h.pt)<b)){q.willSpiderfy=h.willSpiderfy=!0;break}n=this.markers;a=[];b=e=0;for(g=n.length;e<g;b=++e)c=n[b],m[b].willSpiderfy&&a.push(c);return a};d.makeHighlightListenerFuncs=
function(b){return{highlight:function(c){return function(){return b._omsData.leg.setOptions({strokeColor:c.legColors.highlighted[c.map.mapTypeId],zIndex:c.highlightedLegZIndex})}}(this),unhighlight:function(c){return function(){return b._omsData.leg.setOptions({strokeColor:c.legColors.usual[c.map.mapTypeId],zIndex:c.usualLegZIndex})}}(this)}};d.spiderfy=function(b,c){var a,d,e,f,q,h,l,m,n,p;this.spiderfying=!0;p=b.length;a=this.ptAverage(function(){var a,c,e;e=[];a=0;for(c=b.length;a<c;a++)m=b[a],
e.push(m.markerPt);return e}());f=p>=this.circleSpiralSwitchover?this.generatePtsSpiral(p,a).reverse():this.generatePtsCircle(p,a);a=function(){var a,c,m;m=[];a=0;for(c=f.length;a<c;a++)e=f[a],d=this.ptToLl(e),n=this.minExtract(b,function(a){return function(b){return a.ptDistanceSq(b.markerPt,e)}}(this)),l=n.marker,h=new t.Polyline({map:this.map,path:[l.getPosition(),d],strokeColor:this.legColors.usual[this.map.mapTypeId],strokeWeight:this.legWeight,zIndex:this.usualLegZIndex}),l._omsData={usualPosition:l.getPosition(),
leg:h},this.legColors.highlighted[this.map.mapTypeId]!==this.legColors.usual[this.map.mapTypeId]&&(q=this.makeHighlightListenerFuncs(l),l._omsData.hightlightListeners={highlight:k.addListener(l,"mouseover",q.highlight),unhighlight:k.addListener(l,"mouseout",q.unhighlight)}),l.setPosition(d),l.setZIndex(Math.round(this.spiderfiedZIndex+e.y)),m.push(l);return m}.call(this);delete this.spiderfying;this.spiderfied=!0;return this.trigger("spiderfy",a,c)};d.unspiderfy=function(b){var c,a,d,e,f,q,h;null==
b&&(b=null);if(null==this.spiderfied)return this;this.unspiderfying=!0;h=[];f=[];q=this.markers;c=0;for(a=q.length;c<a;c++)e=q[c],null!=e._omsData?(e._omsData.leg.setMap(null),e!==b&&e.setPosition(e._omsData.usualPosition),e.setZIndex(null),d=e._omsData.hightlightListeners,null!=d&&(k.removeListener(d.highlight),k.removeListener(d.unhighlight)),delete e._omsData,h.push(e)):f.push(e);delete this.unspiderfying;delete this.spiderfied;this.trigger("unspiderfy",h,f);return this};d.ptDistanceSq=function(b,
c){var a,d;a=b.x-c.x;d=b.y-c.y;return a*a+d*d};d.ptAverage=function(b){var c,a,d,e,f;c=e=f=0;for(a=b.length;c<a;c++)d=b[c],e+=d.x,f+=d.y;b=b.length;return new t.Point(e/b,f/b)};d.llToPt=function(b){return this.projHelper.getProjection().fromLatLngToDivPixel(b)};d.ptToLl=function(b){return this.projHelper.getProjection().fromDivPixelToLatLng(b)};d.minExtract=function(b,c){var a,d,e,f,k,h;e=k=0;for(h=b.length;k<h;e=++k)if(f=b[e],f=c(f),"undefined"===typeof a||null===a||f<d)d=f,a=e;return b.splice(a,
1)[0]};d.arrIndexOf=function(b,c){var a,d,e,f;if(null!=b.indexOf)return b.indexOf(c);a=d=0;for(e=b.length;d<e;a=++d)if(f=b[a],f===c)return a;return-1};v.ProjHelper=function(b){return this.setMap(b)};v.ProjHelper.prototype=new t.OverlayView;v.ProjHelper.prototype.draw=function(){};return v}())}).call(this);}).call(this);
/* Mon Jun 22 18:14:06 EDT 2015 */
